virtual-audience-app-v2  | Waiting for database...
virtual-audience-db-v2   | 2025-08-20 00:38:42.456 UTC [1] LOG:  starting PostgreSQL 15.14 on x86_64-pc-linux-musl, compiled by gcc (Alpine 14.2.0) 14.2.0, 64-bit
virtual-audience-db-v2   | 2025-08-20 00:38:42.456 UTC [1] LOG:  listening on IPv4 address "0.0.0.0", port 5432
virtual-audience-db-v2   | 2025-08-20 00:38:42.456 UTC [1] LOG:  listening on IPv6 address "::", port 5432
virtual-audience-db-v2   | 2025-08-20 00:38:42.458 UTC [1] LOG:  listening on Unix socket "/var/run/postgresql/.s.PGSQL.5432"
virtual-audience-db-v2   | 2025-08-20 00:38:42.463 UTC [29] LOG:  database system was shut down at 2025-08-20 00:38:00 UTC
virtual-audience-db-v2   | 2025-08-20 00:38:42.475 UTC [1] LOG:  database system is ready to accept connections
virtual-audience-app-v2  | Setting up Virtual Audience Platform with authentication and URL shortening...
virtual-audience-app-v2  | Existing data detected (2 users) - preserving data and updating schema...
virtual-audience-app-v2  | Session tokens table missing - applying migration for existing deployment...
virtual-audience-app-v2  | CREATE TABLE
virtual-audience-app-v2  | ERROR:  relation "links" does not exist
virtual-audience-app-v2  | CONTEXT:  SQL statement "ALTER TABLE "links" ADD COLUMN "session_token" varchar"
virtual-audience-db-v2   | 2025-08-20 00:39:03.293 UTC [50] ERROR:  relation "links" does not exist
virtual-audience-db-v2   | 2025-08-20 00:39:03.293 UTC [50] CONTEXT:  SQL statement "ALTER TABLE "links" ADD COLUMN "session_token" varchar"
virtual-audience-db-v2   |      PL/pgSQL function inline_code_block line 3 at SQL statement
virtual-audience-db-v2   | 2025-08-20 00:39:03.293 UTC [50] STATEMENT:  DO $$ BEGIN
virtual-audience-db-v2   |          IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='links' AND column_name='session_token') THEN
virtual-audience-db-v2   |              ALTER TABLE "links" ADD COLUMN "session_token" varchar;
virtual-audience-db-v2   |          END IF;
virtual-audience-db-v2   |      END $$;
virtual-audience-app-v2  | PL/pgSQL function inline_code_block line 3 at SQL statement
virtual-audience-db-v2   | 2025-08-20 00:39:03.298 UTC [50] ERROR:  relation "viewer_links" does not exist
virtual-audience-db-v2   | 2025-08-20 00:39:03.298 UTC [50] CONTEXT:  SQL statement "ALTER TABLE "viewer_links" ADD COLUMN "session_token" varchar"
virtual-audience-db-v2   |      PL/pgSQL function inline_code_block line 3 at SQL statement
virtual-audience-db-v2   | 2025-08-20 00:39:03.298 UTC [50] STATEMENT:  DO $$ BEGIN
virtual-audience-db-v2   |          IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='viewer_links' AND column_name='session_token') THEN
virtual-audience-db-v2   |              ALTER TABLE "viewer_links" ADD COLUMN "session_token" varchar;
virtual-audience-db-v2   |          END IF;
virtual-audience-db-v2   |      END $$;
virtual-audience-app-v2  | ERROR:  relation "viewer_links" does not exist
virtual-audience-app-v2  | CONTEXT:  SQL statement "ALTER TABLE "viewer_links" ADD COLUMN "session_token" varchar"
virtual-audience-app-v2  | PL/pgSQL function inline_code_block line 3 at SQL statement
virtual-audience-app-v2  | DO
virtual-audience-app-v2  | NOTICE:  table "short_viewer_links" does not exist, skipping
virtual-audience-app-v2  | DROP TABLE
virtual-audience-app-v2  | ERROR:  relation "viewer_links" does not exist
virtual-audience-db-v2   | 2025-08-20 00:39:03.309 UTC [50] ERROR:  relation "viewer_links" does not exist
virtual-audience-db-v2   | 2025-08-20 00:39:03.309 UTC [50] STATEMENT:  CREATE TABLE IF NOT EXISTS "short_viewer_links" (
virtual-audience-db-v2   |              "id" varchar(6) PRIMARY KEY NOT NULL,
virtual-audience-db-v2   |              "viewer_link_id" varchar NOT NULL,
virtual-audience-db-v2   |              "created_at" timestamp DEFAULT now() NOT NULL,
virtual-audience-db-v2   |              "session_token" varchar,
virtual-audience-db-v2   |              CONSTRAINT "short_viewer_links_viewer_link_id_viewer_links_id_fk" FOREIGN KEY ("viewer_link_id") REFERENCES "viewer_links"("id") ON DELETE cascade ON UPDATE no action
virtual-audience-db-v2   |      );
virtual-audience-app-v2  | CREATE INDEX
virtual-audience-app-v2  | CREATE INDEX
virtual-audience-app-v2  | CREATE INDEX
virtual-audience-app-v2  | Session token migration completed
virtual-audience-app-v2  | No config path provided, using default 'drizzle.config.ts'
virtual-audience-app-v2  | Reading config file '/app/drizzle.config.ts'
virtual-audience-app-v2  | Using 'pg' driver for database querying
virtual-audience-app-v2  | [⣷] Pulling schema from database...
[⣯] Pulling schema from database...
[⣟] Pulling schema from database...
[✓] Pulling schema from database...
virtual-audience-app-v2  |
virtual-audience-app-v2  | Is short_viewer_links table created or renamed from another table?
virtual-audience-app-v2  | ❯ + short_viewer_links           create table
virtual-audience-app-v2  |   ~ session › short_viewer_links rename tablenpm notice
virtual-audience-app-v2  | npm notice New major version of npm available! 10.8.2 -> 11.5.2
virtual-audience-app-v2  | npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.5.2
virtual-audience-app-v2  | npm notice To update run: npm install -g npm@11.5.2
virtual-audience-app-v2  | npm notice
virtual-audience-app-v2  | Starting Virtual Audience Platform...
virtual-audience-app-v2  | Using PostgreSQL driver for database connection
virtual-audience-app-v2  | Default admin user already exists
virtual-audience-app-v2  | 12:39:15 AM [express] serving on port 5000
virtual-audience-app-v2  | 12:39:38 AM [express] GET /api/user 200 in 15ms :: {"id":1,"username":"admin","email":"admin@stagelin…
virtual-audience-app-v2  | Creating link with data: {
virtual-audience-app-v2  |   id: '1755650382161',
virtual-audience-app-v2  |   streamName: 'khjhk',
virtual-audience-app-v2  |   returnFeed: 'studio1',
virtual-audience-app-v2  |   chatEnabled: true,
virtual-audience-app-v2  |   url: 'https://dev.stagelinq.com/session?stream=khjhk&return=studio1&chat=true',
virtual-audience-app-v2  |   expiresAt: null
virtual-audience-app-v2  | }
virtual-audience-db-v2   | 2025-08-20 00:39:43.862 UTC [75] ERROR:  column "session_token" of relation "generated_links" does not exist at character 91
virtual-audience-db-v2   | 2025-08-20 00:39:43.862 UTC [75] STATEMENT:  insert into "generated_links" ("id", "stream_name", "return_feed", "chat_enabled", "url", "session_token", "created_at", "expires_at", "created_by") values ($1, $2, $3, $4, $5, $6, $7, $8, $9) returning "id", "stream_name", "return_feed", "chat_enabled", "url", "session_token", "created_at", "expires_at", "created_by"
virtual-audience-app-v2  | Failed to create link: error: column "session_token" of relation "generated_links" does not exist
virtual-audience-app-v2  |     at /app/node_modules/pg-pool/index.js:45:11
virtual-audience-app-v2  |     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
virtual-audience-app-v2  |     at async file:///app/node_modules/drizzle-orm/node-postgres/session.js:83:22
virtual-audience-app-v2  |     at async DatabaseStorage.createLink (file:///app/dist/production.js:219:24)
virtual-audience-app-v2  |     at async file:///app/dist/production.js:800:20 {
virtual-audience-app-v2  |   length: 141,
virtual-audience-app-v2  |   severity: 'ERROR',
virtual-audience-app-v2  |   code: '42703',
virtual-audience-app-v2  |   detail: undefined,
virtual-audience-app-v2  |   hint: undefined,
virtual-audience-app-v2  |   position: '91',
virtual-audience-app-v2  |   internalPosition: undefined,
virtual-audience-app-v2  |   internalQuery: undefined,
virtual-audience-app-v2  |   where: undefined,
virtual-audience-app-v2  |   schema: undefined,
virtual-audience-app-v2  |   table: undefined,
virtual-audience-app-v2  |   column: undefined,
virtual-audience-app-v2  |   dataType: undefined,
virtual-audience-app-v2  |   constraint: undefined,
virtual-audience-app-v2  |   file: 'parse_target.c',
virtual-audience-app-v2  |   line: '1075',
virtual-audience-app-v2  |   routine: 'checkInsertTargets'
virtual-audience-app-v2  | }
virtual-audience-app-v2  | 12:39:43 AM [express] POST /api/links 500 in 49ms :: {"error":"Failed to create link"}
virtual-audience-app-v2  | 12:39:43 AM [express] POST /api/short-links 200 in 45ms :: {"id":"btqMYx","streamName":"khjhk","retur…